# Руководство по тестированию: РУСТ. Разворачивание интеграции с ОСА Магнит

## Обзор тестирования

### Цель
Обеспечить полное тестирование интеграции с OSA Магнит на проекте РУСТ для проверки корректности работы всех компонентов системы.

### Области тестирования
1. **Функциональное тестирование** - проверка основной функциональности
2. **Интеграционное тестирование** - проверка взаимодействия компонентов
3. **Тестирование производительности** - проверка нагрузки и времени отклика
4. **Тестирование безопасности** - проверка защиты данных
5. **Регрессионное тестирование** - проверка отсутствия побочных эффектов

## Тестовые сценарии

### US1: Работа с проблемами товаров

#### Тест-кейс TC1.1: Получение сигналов о проблемах товаров
**Цель**: Проверить корректность получения сигналов о проблемах товаров от API Магнит

**Предусловия**:
- Интеграция с OSA Магнит настроена
- Функциональные флаги включены
- API Магнит доступен

**Шаги выполнения**:
1. Запустить джоб импорта сигналов
2. Проверить получение сигналов типа "проблема товара"
3. Проверить сохранение в таблицу `osa.MagnitSignals`
4. Проверить корректность маппинга кодов товаров

**Ожидаемый результат**:
- Сигналы получены и сохранены
- Коды товаров корректно сопоставлены
- Статус сигналов установлен как "pending"

**Критерии приемки**:
- ✅ Сигналы импортируются без ошибок
- ✅ Все поля сигналов заполнены корректно
- ✅ Связь с кодами товаров работает

#### Тест-кейс TC1.2: Отображение сигналов в мобильном терминале
**Цель**: Проверить отображение сигналов о проблемах товаров в МТ

**Предусловия**:
- Сигналы импортированы в БД
- МТ обновлен до версии с поддержкой Магнит

**Шаги выполнения**:
1. Войти в МТ под пользователем мерчандайзера
2. Выбрать ТТ с кодом Магнит
3. Перейти в раздел "Сигналы Магнит"
4. Проверить отображение списка сигналов

**Ожидаемый результат**:
- Сигналы отображаются в списке
- Показывается описание проблемы
- Доступны кнопки для ответа

**Критерии приемки**:
- ✅ Сигналы отображаются корректно
- ✅ Интерфейс интуитивно понятен
- ✅ Нет критических ошибок

#### Тест-кейс TC1.3: Заполнение ответов на сигналы
**Цель**: Проверить возможность заполнения ответов на сигналы о проблемах товаров

**Предусловия**:
- Сигналы отображаются в МТ
- Пользователь авторизован

**Шаги выполнения**:
1. Выбрать сигнал о проблеме товара
2. Заполнить ответ на сигнал
3. Приложить фотографии (если требуется)
4. Сохранить ответ

**Ожидаемый результат**:
- Ответ сохранен в БД
- Статус сигнала изменен на "answered"
- Фотографии прикреплены

**Критерии приемки**:
- ✅ Ответы сохраняются корректно
- ✅ Фотографии загружаются
- ✅ Статусы обновляются

### US2: Работа с проблемами магазинов

#### Тест-кейс TC2.1: Получение сигналов о проблемах магазинов
**Цель**: Проверить получение сигналов о проблемах магазинов

**Предусловия**:
- Интеграция настроена
- API доступен

**Шаги выполнения**:
1. Запустить импорт сигналов
2. Проверить получение сигналов типа "проблема магазина"
3. Проверить связь с кодами ТТ

**Ожидаемый результат**:
- Сигналы получены
- Связь с ТТ установлена
- Данные сохранены

**Критерии приемки**:
- ✅ Сигналы импортируются
- ✅ Связь с ТТ работает
- ✅ Данные корректны

#### Тест-кейс TC2.2: Обработка сигналов в МТ
**Цель**: Проверить обработку сигналов о проблемах магазинов

**Шаги выполнения**:
1. Открыть сигнал о проблеме магазина
2. Заполнить описание проблемы
3. Указать приоритет
4. Сохранить ответ

**Ожидаемый результат**:
- Ответ сохранен
- Приоритет установлен
- Статус обновлен

**Критерии приемки**:
- ✅ Обработка работает корректно
- ✅ Приоритеты сохраняются
- ✅ Статусы обновляются

### US3: Получение промо от Магнит

#### Тест-кейс TC3.1: Импорт промо-данных
**Цель**: Проверить импорт промо-данных от Магнит

**Предусловия**:
- API Магнит доступен
- Атрибуты для промо созданы

**Шаги выполнения**:
1. Запустить импорт промо-данных
2. Проверить создание атрибутов
3. Проверить заполнение значений

**Ожидаемый результат**:
- Промо-данные импортированы
- Атрибуты созданы
- Значения заполнены

**Критерии приемки**:
- ✅ Импорт работает без ошибок
- ✅ Атрибуты созданы корректно
- ✅ Данные сохранены

#### Тест-кейс TC3.2: Отображение промо в МТ
**Цель**: Проверить отображение промо-данных в МТ

**Шаги выполнения**:
1. Открыть карточку товара в МТ
2. Проверить отображение промо-атрибутов
3. Проверить корректность данных

**Ожидаемый результат**:
- Промо-данные отображаются
- Атрибуты показываются корректно
- Данные актуальны

**Критерии приемки**:
- ✅ Отображение работает
- ✅ Данные корректны
- ✅ Интерфейс понятен

### US4: Получение ассортиментных матриц

#### Тест-кейс TC4.1: Импорт ассортиментных матриц
**Цель**: Проверить импорт ассортиментных матриц от Магнит

**Шаги выполнения**:
1. Запустить импорт ассортиментных матриц
2. Проверить создание записей
3. Проверить связь с товарами

**Ожидаемый результат**:
- Матрицы импортированы
- Связи установлены
- Данные корректны

**Критерии приемки**:
- ✅ Импорт работает
- ✅ Связи корректны
- ✅ Данные актуальны

#### Тест-кейс TC4.2: Использование матриц в МТ
**Цель**: Проверить использование ассортиментных матриц в МТ

**Шаги выполнения**:
1. Открыть раздел ассортимента в МТ
2. Проверить отображение матриц
3. Проверить фильтрацию по ТТ

**Ожидаемый результат**:
- Матрицы отображаются
- Фильтрация работает
- Данные актуальны

**Критерии приемки**:
- ✅ Отображение корректно
- ✅ Фильтрация работает
- ✅ Производительность приемлема

## Интеграционное тестирование

### Тест-кейс IT1: Полный цикл работы с сигналами
**Цель**: Проверить полный цикл от получения до отправки ответов

**Шаги выполнения**:
1. Запустить импорт сигналов
2. Проверить отображение в МТ
3. Заполнить ответы
4. Запустить экспорт ответов
5. Проверить отправку в API

**Ожидаемый результат**:
- Цикл работает полностью
- Данные передаются корректно
- Ошибок нет

**Критерии приемки**:
- ✅ Полный цикл работает
- ✅ Данные корректны
- ✅ Производительность приемлема

### Тест-кейс IT2: Формирование договоров
**Цель**: Проверить автоматическое формирование договоров

**Шаги выполнения**:
1. Импортировать данные о ТТ
2. Проверить создание договоров
3. Проверить связь с дистрибьюторами
4. Проверить обновление существующих договоров

**Ожидаемый результат**:
- Договоры создаются автоматически
- Связи устанавливаются корректно
- Обновления работают

**Критерии приемки**:
- ✅ Автоматизация работает
- ✅ Связи корректны
- ✅ Обновления применяются

## Тестирование производительности

### Тест-кейс PT1: Нагрузочное тестирование импорта
**Цель**: Проверить производительность импорта сигналов

**Параметры теста**:
- Количество сигналов: 1000
- Время выполнения: < 5 минут
- Использование памяти: < 2 GB

**Шаги выполнения**:
1. Подготовить тестовые данные
2. Запустить импорт
3. Измерить время выполнения
4. Проверить использование ресурсов

**Ожидаемый результат**:
- Импорт завершается в срок
- Ресурсы используются эффективно
- Ошибок нет

**Критерии приемки**:
- ✅ Время выполнения в пределах нормы
- ✅ Память используется эффективно
- ✅ Ошибок нет

### Тест-кейс PT2: Тестирование API
**Цель**: Проверить производительность работы с API

**Параметры теста**:
- Количество запросов: 100
- Время отклика: < 2 секунды
- Успешность: > 95%

**Шаги выполнения**:
1. Отправить серию запросов к API
2. Измерить время отклика
3. Проверить успешность
4. Проанализировать ошибки

**Ожидаемый результат**:
- API отвечает быстро
- Успешность высокая
- Ошибки минимальны

**Критерии приемки**:
- ✅ Время отклика приемлемо
- ✅ Успешность высокая
- ✅ Ошибки обрабатываются

## Тестирование безопасности

### Тест-кейс ST1: Аутентификация
**Цель**: Проверить безопасность аутентификации

**Шаги выполнения**:
1. Проверить использование сертификатов
2. Проверить шифрование данных
3. Проверить валидацию токенов
4. Проверить логирование доступа

**Ожидаемый результат**:
- Аутентификация безопасна
- Данные шифруются
- Токены валидны
- Доступ логируется

**Критерии приемки**:
- ✅ Безопасность обеспечена
- ✅ Шифрование работает
- ✅ Валидация корректна
- ✅ Логирование активно

### Тест-кейс ST2: Защита данных
**Цель**: Проверить защиту передаваемых данных

**Шаги выполнения**:
1. Проверить HTTPS соединение
2. Проверить шифрование в БД
3. Проверить маскирование в логах
4. Проверить права доступа

**Ожидаемый результат**:
- Данные защищены
- Шифрование активно
- Логи безопасны
- Права корректны

**Критерии приемки**:
- ✅ Защита данных обеспечена
- ✅ Шифрование активно
- ✅ Логи безопасны
- ✅ Права настроены

## Регрессионное тестирование

### Тест-кейс RT1: Влияние на существующую функциональность
**Цель**: Проверить отсутствие влияния на существующие функции

**Шаги выполнения**:
1. Протестировать основные функции МТ
2. Проверить работу с другими интеграциями
3. Проверить производительность системы
4. Проверить стабильность

**Ожидаемый результат**:
- Существующие функции работают
- Производительность не снижена
- Система стабильна
- Конфликтов нет

**Критерии приемки**:
- ✅ Существующие функции работают
- ✅ Производительность не пострадала
- ✅ Система стабильна
- ✅ Конфликтов нет

## Автоматизированное тестирование

### Настройка тестовой среды
```yaml
# test_config.yml
test_environment:
  database:
    server: "test-sql-server"
    database: "Houston_Test"
    username: "test_user"
    password: "test_password"
  
  api:
    base_url: "https://test-api.magnet.ru/osa/v2/"
    client_id: "test_client_id"
    client_secret: "test_client_secret"
  
  mobile_terminal:
    version: "2.0.0"
    test_user: "test_merchandiser"
    test_password: "test_password"
```

### Unit тесты
```csharp
[TestClass]
public class MagnitSignalsServiceTests
{
    [TestMethod]
    public void ImportSignals_ValidData_ShouldImportSuccessfully()
    {
        // Arrange
        var service = new MagnitSignalsService();
        var testSignals = CreateTestSignals();
        
        // Act
        var result = service.ImportSignals(testSignals);
        
        // Assert
        Assert.IsTrue(result.Success);
        Assert.AreEqual(testSignals.Count, result.ImportedCount);
    }
    
    [TestMethod]
    public void ProcessSignal_ValidSignal_ShouldProcessCorrectly()
    {
        // Arrange
        var service = new MagnitSignalsService();
        var signal = CreateTestSignal();
        
        // Act
        var result = service.ProcessSignal(signal);
        
        // Assert
        Assert.IsTrue(result.Success);
        Assert.AreEqual("processed", result.Status);
    }
}
```

### Integration тесты
```csharp
[TestClass]
public class MagnitIntegrationTests
{
    [TestMethod]
    public async Task FullWorkflow_ShouldWorkEndToEnd()
    {
        // Arrange
        var apiClient = new MagnitApiClient();
        var signalsService = new MagnitSignalsService();
        var mobileTerminal = new MobileTerminalClient();
        
        // Act
        var signals = await apiClient.GetSignalsAsync();
        var importResult = signalsService.ImportSignals(signals);
        var displayResult = mobileTerminal.DisplaySignals();
        var answerResult = mobileTerminal.AnswerSignal("signal1", "Test answer");
        var exportResult = signalsService.ExportAnswers();
        
        // Assert
        Assert.IsTrue(importResult.Success);
        Assert.IsTrue(displayResult.Success);
        Assert.IsTrue(answerResult.Success);
        Assert.IsTrue(exportResult.Success);
    }
}
```

## Мониторинг тестирования

### Метрики для отслеживания
- **Успешность тестов**: Процент прошедших тестов
- **Время выполнения**: Время выполнения тестовых сценариев
- **Покрытие кода**: Процент покрытия тестами
- **Количество багов**: Найденные и исправленные баги

### Дашборд тестирования
```sql
-- Создание представления для мониторинга тестов
CREATE VIEW vw_TestResults AS
SELECT 
    TestSuite,
    TestCase,
    Status,
    ExecutionTime,
    ErrorMessage,
    ExecutionDate
FROM TestResults
WHERE ExecutionDate >= DATEADD(day, -7, GETDATE());

-- Запрос для получения статистики
SELECT 
    Status,
    COUNT(*) as Count,
    AVG(ExecutionTime) as AvgExecutionTime
FROM vw_TestResults
GROUP BY Status;
```

## План тестирования

### Фаза 1: Подготовка (1 день)
- [ ] Настройка тестовой среды
- [ ] Подготовка тестовых данных
- [ ] Настройка автоматизации
- [ ] Создание тестовых пользователей

### Фаза 2: Функциональное тестирование (2 дня)
- [ ] Тестирование US1 (проблемы товаров)
- [ ] Тестирование US2 (проблемы магазинов)
- [ ] Тестирование US3 (промо-данные)
- [ ] Тестирование US4 (ассортиментные матрицы)

### Фаза 3: Интеграционное тестирование (1 день)
- [ ] Тестирование полного цикла
- [ ] Тестирование формирования договоров
- [ ] Тестирование взаимодействия компонентов

### Фаза 4: Тестирование производительности (1 день)
- [ ] Нагрузочное тестирование
- [ ] Тестирование API
- [ ] Анализ производительности

### Фаза 5: Тестирование безопасности (1 день)
- [ ] Тестирование аутентификации
- [ ] Тестирование защиты данных
- [ ] Аудит безопасности

### Фаза 6: Регрессионное тестирование (1 день)
- [ ] Тестирование существующих функций
- [ ] Проверка совместимости
- [ ] Финальная проверка

## Критерии готовности к продакшену

### Функциональные критерии
- [ ] Все тест-кейсы пройдены успешно
- [ ] Критические баги исправлены
- [ ] Функциональность работает согласно требованиям
- [ ] Пользовательский интерфейс корректен

### Технические критерии
- [ ] Производительность в пределах нормы
- [ ] Безопасность обеспечена
- [ ] Мониторинг настроен
- [ ] Логирование работает

### Качественные критерии
- [ ] Покрытие тестами > 80%
- [ ] Время выполнения тестов < 2 часов
- [ ] Количество багов < 5
- [ ] Документация обновлена

## Отчетность

### Ежедневные отчеты
- Статус выполнения тестов
- Найденные баги
- Блокеры и риски
- План на следующий день

### Финальный отчет
- Общая статистика тестирования
- Список найденных и исправленных багов
- Рекомендации по улучшению
- Заключение о готовности к продакшену

## Контакты

### Команда тестирования
- **Руководитель тестирования**: Макаренко Илья
- **Функциональный тестировщик**: [Имя тестировщика]
- **Автоматизатор**: [Имя автоматизатора]
- **Тестировщик производительности**: [Имя тестировщика]

### Эскалация проблем
- **Критические баги**: Немедленно
- **Блокеры**: В течение 2 часов
- **Обычные баги**: В течение 1 дня
- **Улучшения**: В течение недели

---
*Документ создан: 27.09.2025*  
*Версия: 1.0*  
*Статус: Готов к использованию*
