# Архитектура системы "Транзитные заказы"

## Обзор архитектуры

Система "Транзитные заказы" построена на основе мобильного терминала (МТ) с интеграцией в базу данных Chicago и учетную систему 1С.

## Основные компоненты (из TFS)

### 1. Мобильный терминал (МТ)
- **Версия**: 5.2.16
- **Функционал**: Интерфейс для выбора параметров транзитных заказов
- **Компоненты**:
  - Кастомный компонент ввода для выбора значений
  - Серийные диалоговые окна для пошагового выбора
  - Валидация и сохранение выбранных значений

### 2. База данных Chicago
- **Версия**: 3.6.201.4
- **Таблицы**:
  - `nsf.refTransitOrdersExtendedAttributes` - Справочник атрибутов транзитных заказов
  - Индивидуальная таблица для хранения логики зависимостей
- **Функционал**:
  - Хранение иерархической структуры атрибутов
  - Фильтрация данных для выгрузки в МТ
  - Управление зависимостями между полями

### 3. Система репликации
- **Сервис**: Replication.Shuttle
- **Версия**: 3.6.205.4
- **Функционал**: Синхронизация данных между Chicago и МТ

### 4. Интеграция с 1С
- **Функционал**: Передача параметров транзитных заказов
- **Поля передачи** (из основного запроса 221894):
  - Тип лицензии (оптовая/розничная)
  - Выбранный магазин (для розничных магазинов)
  - Префикс заказа
  - Признак "Это розница" (для розничной лицензии ЛД)
  - Дата отгрузки (минус один день от даты отгрузки товара клиенту)

## Реализованные компоненты (из TFS)

### 1. Component-libs
- **Назначение**: Модификация конструктора форм
- **Функционал**:
  - Создание обработчика для правил в компоненте
  - Добавление обработчика для типа

### 2. Shared-libs
- **Назначение**: Библиотека для конструктора форм
- **Компоненты**:
  - FormRulesFactory - Фабрика правил
  - FormRulesService - Сервис по работе с правилами
  - TreeToConstructorAdapter - Модель представления зависимых полей

## Потоки данных (из TFS)

### 1. Загрузка справочников
```
1С → Chicago → Replication.Shuttle → МТ
```

### 2. Выбор параметров заказа
```
Пользователь → МТ → Валидация → Сохранение в МТ
```

### 3. Передача в 1С
```
МТ → API → 1С (с параметрами транзитного заказа)
```

## Обработка ошибок (из TFS)

### Исправленные проблемы

**Ошибка 231567** - Кнопка "Сохранить" в окне Тип лицензии:
- Добавлена логика на доступность кнопки "Сохранить"
- При открытии формы выбора доп.атрибутов форма запоминает значения по дефолту
- Если выбранные значения будут совпадать со значениями по дефолту, кнопка "Сохранить" не будет доступна

**Ошибка 231570** - Логика возвращения значений:
- Реализована логика возвращения значений по умолчанию при изменении значения Транзитного заказа с "Да" на "Нет"

**Ошибка 231484** - Лишняя строка с нулями:
- Добавлена фильтрация в выгрузку ХП для исключения нулевых значений